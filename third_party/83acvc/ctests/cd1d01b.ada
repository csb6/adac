-- CD1D01B.ADA

-- OBJECTIVE:
--     CHECK WHETHER A PRAGMA PACK IS OBEYED FOR A RECORD HAVING
--     COMPONENTS THAT ARE ALL OF A BOOLEAN TYPE OR ALL OF A
--     CHARACTER TYPE.  CHECK WHETHER THE SIZE IS AFFECTED AND,
--     IF SO, WHETHER THE MINIMUM SPACE IS USED.

-- HISTORY:
--     JET 08/13/87 CREATED ORIGINAL TEST.
--     PWB 03/27/89 MODIFIED CHECK OF OBJECT SIZE AGAINST TYPE SIZE.

WITH REPORT; USE REPORT;
PROCEDURE CD1D01B IS

     TYPE BOOL_REC IS RECORD
          B1: BOOLEAN;
          B2, B3, B4, B5, B6, B7: BOOLEAN;
          B8, B9, B10: BOOLEAN;
     END RECORD;

     TYPE PACKED_BOOL_REC IS RECORD
          B1: BOOLEAN;
          B2, B3, B4, B5, B6, B7: BOOLEAN;
          B8, B9, B10: BOOLEAN;
     END RECORD;

     PRAGMA PACK (PACKED_BOOL_REC);

     XBOOL : PACKED_BOOL_REC := (OTHERS => IDENT_BOOL (TRUE) );

     TYPE CHAR_REC IS RECORD
          C1: CHARACTER;
          C2, C3, C4, C5, C6: CHARACTER;
          C7, C8, C9, C10: CHARACTER;
     END RECORD;

     TYPE PACKED_CHAR_REC IS RECORD
          C1: CHARACTER;
          C2, C3, C4, C5, C6: CHARACTER;
          C7, C8, C9, C10: CHARACTER;
     END RECORD;

     PRAGMA PACK (PACKED_CHAR_REC);

     XCHAR : PACKED_CHAR_REC := (OTHERS => IDENT_CHAR('A'));

BEGIN

     TEST("CD1D01B", "CHECK WHETHER A PRAGMA PACK IS OBEYED " &
                     "FOR A RECORD HAVING COMPONENTS THAT " &
                     "ARE ALL OF A BOOLEAN TYPE OR ALL OF A " &
                     "CHARACTER TYPE.  CHECK WHETHER THE SIZE " &
                     "IS AFFECTED AND, IF SO, WHETHER THE " &
                     "MINIMUM SPACE IS USED");

     IF BOOL_REC'SIZE > PACKED_BOOL_REC'SIZE THEN
          COMMENT ("PRAGMA PACK WAS OBEYED FOR A RECORD " &
                   "WITH TEN BOOLEAN COMPONENTS. " &
                   "THE SIZE OF THE ORIGINAL RECORD IS" &
                   INTEGER'IMAGE (BOOL_REC'SIZE) & "; " &
                   "THE SIZE OF THE PACKED RECORD IS" &
                   INTEGER'IMAGE (PACKED_BOOL_REC'SIZE));
          IF PACKED_BOOL_REC'SIZE = 10 THEN
               COMMENT("THE SIZE OF THE PACKED BOOLEAN RECORD " &
                       "IS MINIMAL");
          END IF;
     ELSIF BOOL_REC'SIZE = PACKED_BOOL_REC'SIZE THEN
          COMMENT ("PRAGMA PACK HAD NO EFFECT ON A RECORD " &
                   "WITH TEN BOOLEAN COMPONENTS. " &
                   "THE SIZE OF THE ORIGINAL RECORD AND OF THE " &
                   "PACKED RECORD IS" &
                   INTEGER'IMAGE (PACKED_BOOL_REC'SIZE));
          IF PACKED_BOOL_REC'SIZE = 10 THEN
               COMMENT("THE SIZE OF THE PACKED BOOLEAN RECORD " &
                       "IS ALREADY MINIMAL");
          END IF;
     ELSE
          FAILED ("THE SIZE OF THE PACKED BOOLEAN RECORD IS GREATER " &
                  "THAN THAT OF THE ORIGINAL RECORD");
     END IF;

     IF XBOOL'SIZE < PACKED_BOOL_REC'SIZE THEN
          FAILED ("PACKED BOOLEAN RECORD OBJECT SIZE IS TOO SMALL" &
                  "FIRST COMPONENT IS " &
                  BOOLEAN'IMAGE (IDENT_BOOL(TRUE)) );
     END IF;

     IF CHAR_REC'SIZE > PACKED_CHAR_REC'SIZE THEN
          COMMENT ("PRAGMA PACK WAS OBEYED FOR A RECORD " &
                   "WITH TEN CHARACTER COMPONENTS. " &
                   "THE SIZE OF THE ORIGINAL RECORD IS" &
                   INTEGER'IMAGE (CHAR_REC'SIZE) & "; " &
                   "THE SIZE OF THE PACKED RECORD IS" &
                   INTEGER'IMAGE (PACKED_CHAR_REC'SIZE));
          IF PACKED_CHAR_REC'SIZE = 80 THEN
               COMMENT("THE SIZE OF THE PACKED CHARACTER RECORD " &
                       "IS MINIMAL");
          END IF;
     ELSIF CHAR_REC'SIZE = PACKED_CHAR_REC'SIZE THEN
          COMMENT ("PRAGMA PACK HAD NO EFFECT ON A RECORD " &
                   "WITH TEN CHARACTER COMPONENTS. " &
                   "THE SIZE OF THE ORIGINAL RECORD AND OF THE " &
                   "PACKED RECORD IS" &
                   INTEGER'IMAGE (PACKED_CHAR_REC'SIZE));
          IF PACKED_CHAR_REC'SIZE = 80 THEN
               COMMENT("THE SIZE OF THE PACKED CHARACTER RECORD " &
                       "IS ALREADY MINIMAL");
          END IF;
     ELSE
          FAILED ("THE SIZE OF THE PACKED CHARCTER RECORD IS " &
                  "GREATER THAN THAT OF THE ORIGINAL RECORD");
     END IF;

     IF XCHAR'SIZE < PACKED_CHAR_REC'SIZE THEN
          FAILED ("PACKED CHARACTER RECORD OBJECT SIZE IS TOO SMALL" &
                  "FIRST COMPONENT IS " &
                  CHARACTER'IMAGE (IDENT_CHAR('A')) );
     END IF;

     RESULT;

END CD1D01B;
