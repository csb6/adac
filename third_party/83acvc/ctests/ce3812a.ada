-- CE3812A.ADA

-- OBJECTIVE:
--     CHECK THAT SAFE FLOATING POINT NUMBERS ARE OUTPUT EXACTLY IF AFT
--     IS SUFFICIENTLY LARGE AND THAT NUMBERS LYING BETWEEN MODEL
--     NUMBERS ARE CORRECTLY ROUNDED ON OUTPUT.

-- HISTORY:
--     JET 08/23/88  CREATED ORIGINAL TEST.

WITH REPORT; USE REPORT;
WITH TEXT_IO; USE TEXT_IO;
PROCEDURE CE3812A IS

     TYPE FLOAT6 IS DIGITS 6;

     PACKAGE FIO IS NEW FLOAT_IO(FLOAT6);
     USE FIO;

     F6, X, Y, Z : FLOAT6;
     STRX, STRY, STRZ : STRING(1..100) := (OTHERS => ' ');
     LAST : POSITIVE;

     F : FILE_TYPE;
     OK : BOOLEAN := FALSE;

BEGIN
     TEST ("CE3812A", "CHECK THAT SAFE FLOATING POINT NUMBERS ARE " &
                      "OUTPUT EXACTLY IF AFT IS SUFFICIENTLY LARGE " &
                      "AND THAT NUMBERS LYING BETWEEN MODEL NUMBERS " &
                      "ARE CORRECTLY ROUNDED ON OUTPUT");

     X := 2#0.1000_0000_0000_0000_0000_0#E-84;
     Y := 2#0.1111_1111_1111_1111_1111_1#E+84;
     Z := 2#0.1000_0000_0000_0000_0000_0111_1111_1111#E+1 +
          FLOAT6(IDENT_INT(0));

     PUT(STRX, X, AFT => 59);
     IF STRX(36..100) /= IDENT_STR("2.5849394142282114839731521627186" &
                                   "3391739316284656524658203125E-26")
     THEN
          FAILED("RESULT FROM STRING PUT IS NOT EXACT (X)");
     END IF;

     PUT(STRY, Y, AFT => 30);
     IF STRY(65..100) /=
        IDENT_STR("1.934280389046202994052300800000E+25")
     THEN
          FAILED("RESULT FROM STRING PUT IS NOT EXACT (Y)");
     END IF;

     PUT(STRZ, Z, AFT => 21);
     IF STRZ(74..100) /= IDENT_STR("1.000000000000000000000E+00") AND
        STRZ(74..100) /= IDENT_STR("1.000000953674316406250E+00") THEN
          FAILED("RESULT FROM STRING PUT IS NOT CORRECT (Z)");
     END IF;

     BEGIN
          CREATE(F, OUT_FILE, LEGAL_FILE_NAME);
          OK := TRUE;
     EXCEPTION
          WHEN USE_ERROR | NAME_ERROR =>
               COMMENT("UNABLE TO CREATE DATA FILE FOR FILE CHECKS");
     END;

     IF OK THEN
          PUT(F, X, AFT => 59); NEW_LINE(F);
          PUT(F, Y, AFT => 30); NEW_LINE(F);
          PUT(F, Z, AFT => 21); NEW_LINE(F);
          CLOSE(F);
          OPEN(F, IN_FILE, LEGAL_FILE_NAME);

          GET(F, F6);
          IF F6 /= X THEN
               FAILED("RESULT FROM FILE PUT IS NOT EXACT (X)");
          END IF;

          GET(F, F6);
          IF F6 /= Y THEN
               FAILED("RESULT FROM FILE PUT IS NOT EXACT (Y)");
          END IF;

          GET(F, F6);
          IF F6 < 2#0.1000_0000_0000_0000_0000_0#E+1 OR
             F6 > 2#0.1000_0000_0000_0000_0000_1#E+1 THEN
               FAILED("RESULT FROM FILE PUT IS NOT CORRECT (Z)");
          END IF;

          BEGIN
               DELETE(F);
          EXCEPTION
               WHEN USE_ERROR =>
                    COMMENT ("DATA FILE COULD NOT BE DELETED");
          END;
     END IF;

     RESULT;
END CE3812A;
