-- CA2009F0M.DEP

-- OBJECTIVE:
--     CHECK THAT A GENERIC SUBPROGRAM SUBUNIT CAN BE SPECIFIED AND
--     INSTANTIATED.  IN THIS TEST, SOME SUBUNIT BODIES ARE
--     IN SEPARATE FILES.

-- SEPARATE FILES ARE:
--     CA2009F0M  THE MAIN PROCEDURE, WITH SUBUNIT BODIES FOR
--                     PROC2 AND FUNC2.
--     CA2009F1   A SUBUNIT PROCEDURE BODY (PROC1).
--     CA2009F2   A SUBUNIT FUNCTION BODY  (FUNC1).

-- APPLICABILITY CRITERIA:
--     THIS TEST APPLIES ONLY TO IMPLEMENTATIONS WHICH ALLOW A GENERIC
--     DECLARATION AND BODY TO BE IN DIFFERENT FILES.
--
--     THIS TEST MUST NOT EXECUTE IF AN IMPLEMENTATION REQUIRES THAT
--     GENERIC SUBPROGRAM BODIES AS SUBUNITS BE IN THE SAME FILE AS
--     THE SPECS.

-- HISTORY:
--     BHS 08/01/84  CREATED ORIGINAL TEST.
--     PWB 02/19/86  ADDED "SOME" TO FIRST COMMENT.
--     BCB 01/05/88  MODIFIED HEADER.

WITH REPORT;
USE REPORT;
PROCEDURE CA2009F0M IS

     INT1 : INTEGER := 1;
     INT2 : INTEGER := 2;
     INT3 : INTEGER := 3;
     INT4 : INTEGER := 4;


     GENERIC
          TYPE ELEM IS PRIVATE;
          PCON1 : IN ELEM;
          PVAR1 : IN OUT ELEM;
     PROCEDURE PROC1;

     GENERIC
          TYPE ELEM IS PRIVATE;
          PCON2 : IN ELEM;
          PVAR2 : IN OUT ELEM;
     PROCEDURE PROC2;

     GENERIC
          TYPE OBJ IS PRIVATE;
          FCON1 : IN OBJ;
          FVAR1 : IN OUT OBJ;
     FUNCTION FUNC1 RETURN OBJ;

     GENERIC
          TYPE OBJ IS PRIVATE;
          FCON2 : IN OBJ;
          FVAR2 : IN OUT OBJ;
     FUNCTION FUNC2 RETURN OBJ;


     PROCEDURE PROC1 IS SEPARATE;
     PROCEDURE PROC2 IS SEPARATE;
     FUNCTION FUNC1 RETURN OBJ IS SEPARATE;
     FUNCTION FUNC2 RETURN OBJ IS SEPARATE;


     PROCEDURE NI_PROC1 IS NEW PROC1 (INTEGER, 2, INT1);
     PROCEDURE NI_PROC2 IS NEW PROC2 (INTEGER, 3, INT2);
     FUNCTION NI_FUNC1 IS NEW FUNC1 (INTEGER, 4, INT3);
     FUNCTION NI_FUNC2 IS NEW FUNC2 (INTEGER, 5, INT4);


BEGIN

     TEST ("CA2009F", "SPECIFICATION AND INSTANTIATION " &
                      "OF GENERIC SUBPROGRAM SUBUNITS");

     COMMENT ("THIS TEST MUST NOT EXECUTE IF GENERIC " &
              "SUBPROGRAM BODIES (AS SUBUNITS) ARE REQUIRED " &
              "TO BE IN THE SAME FILE AS THE SPECIFICATIONS");

     NI_PROC1;
     IF INT1 /= 2 THEN
          FAILED ("INCORRECT INSTANTIATION - NI_PROC1");
     END IF;

     NI_PROC2;
     IF INT2 /= 3 THEN
          FAILED ("INCORRECT INSTANTIATION - NI_PROC2");
     END IF;

     IF NI_FUNC1 /= 4 THEN
          FAILED ("INCORRECT INSTANTIATION - NI_FUNC1");
     END IF;

     IF NI_FUNC2 /= 5 THEN
          FAILED ("INCORRECT INSTANTIATION - NI_FUNC2");
     END IF;


     RESULT;

END CA2009F0M;


SEPARATE (CA2009F0M)
PROCEDURE PROC2 IS
BEGIN
     PVAR2 := PCON2;
END PROC2;

SEPARATE (CA2009F0M)
FUNCTION FUNC2 RETURN OBJ IS
BEGIN
     FVAR2 := FCON2;
     RETURN FVAR2;
END FUNC2;
