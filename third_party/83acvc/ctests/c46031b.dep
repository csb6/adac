-- C46031B.DEP

-- OBJECTIVE:
--     CHECK CONVERSIONS TO FIXED POINT TYPES WHEN THE OPERAND TYPE
--     IS AN INTEGER TYPE AND THE VALUE OF 'SMALL OF THE TARGET TYPE
--     IS NOT A POWER OF TWO.

-- APPLICABILITY CRITERIA:
--     THIS TEST IS APPLICABLE ONLY TO IMPLEMENTATIONS THAT SUPPORT
--     A VALUE OF 'SMALL NOT EQUAL TO A POWER OF TWO FOR FIXED POINT
--     TYPES.

--     IF SUCH A VALUE FOR 'SMALL IS NOT SUPPORTED, THEN THE
--     REPRESENTATION CLAUSE FOR "FIX1" MUST BE REJECTED.

-- HISTORY:
--     JET 07/11/88  CREATED ORIGINAL TEST.

WITH REPORT; USE REPORT;
PROCEDURE C46031B IS

     TYPE FIX1 IS DELTA 2#0.1# RANGE -16#20.0# .. 16#20.0#;
     FOR FIX1'SMALL USE 2#0.011#;               -- N/A => ERROR.
     TYPE FIX2 IS DELTA 2#0.001# RANGE -16#80.0# .. 16#80.0#;
     FOR FIX2'SMALL USE 2#0.00011#;
     TYPE FIX3 IS DELTA 2#0.00001# RANGE -16#200.0# .. 16#200.0#;
     FOR FIX3'SMALL USE 2#0.0000011#;

     TYPE NEW_INT IS NEW INTEGER RANGE -16#200# .. 16#200#;

     I : INTEGER;
     J : NEW_INT;

     FUNCTION IDENT_NEW (X : NEW_INT) RETURN NEW_INT IS
     BEGIN
          RETURN X * NEW_INT(IDENT_INT(1));
     END IDENT_NEW;

BEGIN
     TEST ("C46031B", "CHECK CONVERSIONS TO FIXED POINT TYPES WHEN " &
                      "THE OPERAND TYPE IS AN INTEGER TYPE AND THE " &
                      "VALUE OF 'SMALL OF THE TARGET TYPE IS NOT A " &
                      "POWER OF TWO");

     I := IDENT_INT(-16#1E#);
     IF FIX1(I) /= -16#1E.0# THEN
          FAILED ("INCORRECT RESULT FROM CONVERSION (1)");
     END IF;

     J := IDENT_NEW(-16#0#);
     IF FIX1(J) /= -16#0.0# THEN
          FAILED ("INCORRECT RESULT FROM CONVERSION (2)");
     END IF;

     I := IDENT_INT(16#7F#);
     IF FIX2(I) NOT IN 16#7E.F0# .. 16#7F.08# THEN
          FAILED ("INCORRECT RESULT FROM CONVERSION (3)");
     END IF;

     J := IDENT_NEW(-16#2#);
     IF FIX2(J) NOT IN -16#2.10# .. -16#1.F8# THEN
          FAILED ("INCORRECT RESULT FROM CONVERSION (4)");
     END IF;

     I := IDENT_INT(-16#1FF#);
     IF FIX3(I) NOT IN -16#1FF.02# .. -16#1FE.FC# THEN
          FAILED ("INCORRECT RESULT FROM CONVERSION (5)");
     END IF;

     J := IDENT_NEW(-16#3#);
     IF FIX3(J) /= -16#3.0# THEN
          FAILED ("INCORRECT RESULT FROM CONVERSION (6)");
     END IF;

     RESULT;

END C46031B;
