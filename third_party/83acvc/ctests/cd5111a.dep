-- CD5111A.DEP

-- OBJECTIVE:
--     CHECK THAT IF ADDRESS CLAUSES FOR ENTRIES OF SINGLE TASKS
--     ARE SUPPORTED, THEN SUCH A CLAUSE CAN BE GIVEN FOR AN ENTRY
--     OF A TASK TYPE.

-- APPLICABILITY CRITERIA:
--     THIS TEST IS APPLICABLE ONLY TO IMPLEMENTATIONS THAT SUPPORT
--     ADDRESS CLAUSES FOR ENTRIES OF SINGLE TASKS, AND THEN ONLY IF
--     THE IMPLEMENTATION'S ADDRESS TYPE IS NOT LIMITED.

--     IF SUCH ADDRESS CLAUSES ARE NOT SUPPORTED, THEN THE ADDRESS
--     CLAUSE FOR CHECK_ENT MUST BE REJECTED.  IF THE ADDRESS TYPE IS
--     LIMITED, THEN THE INITIALIZATION OF CHECK_ADDRESS MUST BE
--     REJECTED.

-- HISTORY:
--     JET 02/02/88  CREATED ORIGINAL TEST.

WITH REPORT; USE REPORT;
WITH SYSTEM; USE SYSTEM;
WITH SPPRT13; USE SPPRT13;

PROCEDURE CD5111A IS

     VAL : INTEGER;

     CHECK_ADDRESS : SYSTEM.ADDRESS := SPPRT13.ENTRY_ADDRESS;
                                                      -- N/A => ERROR.

     PROCEDURE PROC1 IS
          TASK CHECK_TASK IS
               ENTRY CHECK_ENT;
               FOR CHECK_ENT USE AT ENTRY_ADDRESS;    -- N/A => ERROR.
          END CHECK_TASK;

          TASK BODY CHECK_TASK IS
          BEGIN
               ACCEPT CHECK_ENT DO
                    NULL;
               END CHECK_ENT;
          END CHECK_TASK;
     BEGIN
          NULL;
     END PROC1;

     PROCEDURE PROC2 IS
          TASK TYPE TYPE_TASK IS
               ENTRY TYPE_ENT (V : OUT INTEGER);
               FOR TYPE_ENT USE AT ENTRY_ADDRESS;
          END TYPE_TASK;

          T : TYPE_TASK;

          TASK BODY TYPE_TASK IS
          BEGIN
               ACCEPT TYPE_ENT (V : OUT INTEGER) DO
                    V := IDENT_INT(2);
               END TYPE_ENT;
          END TYPE_TASK;
     BEGIN
          T.TYPE_ENT(VAL);
          IF VAL /= 2 THEN
               FAILED ("INCORRECT RETURN VALUE FROM ENTRY");
          END IF;
          IF T.TYPE_ENT'ADDRESS /= SPPRT13.ENTRY_ADDRESS THEN
               FAILED ("INCORRECT ADDRESS FOR ENTRY");
          END IF;
     END PROC2;

BEGIN
     TEST ("CD5111A", "CHECK THAT IF ADDRESS CLAUSES FOR ENTRIES " &
                      "OF SINGLE TASKS ARE SUPPORTED, THEN SUCH " &
                      "A CLAUSE CAN BE GIVEN FOR AN ENTRY OF A " &
                      "TASK TYPE");

     PROC2;

     RESULT;

END CD5111A;
