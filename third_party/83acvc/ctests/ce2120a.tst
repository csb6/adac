-- CE2120A.TST

-- OBJECTIVE:
--     FOR DIRECT_IO, CHECK THAT IF THE IMPLEMENTATION ALLOWS
--     ALTERNATE FORMS OF THE NAME, THEN NAME RETURNS A FULL
--     SPECIFICATION OF THE NAME.

-- MACRO SUBSTITUTION:
--     $NAME_SPECIFICATION1 IS THE FULL SPECIFICATION FOR THE NAME OF
--     THE FILE RETURNED BY THE FUNCTION LEGAL_FILE_NAME.

-- HISTORY:
--     BCB 09/21/88  CREATED ORIGINAL TEST.

WITH REPORT; USE REPORT;
WITH DIRECT_IO;

PROCEDURE CE2120A IS

     PACKAGE DIR_IO IS NEW DIRECT_IO(INTEGER); USE DIR_IO;

     FILE : FILE_TYPE;

     INCOMPLETE : EXCEPTION;

     TYPE ACC_STR IS ACCESS STRING;

     NAME_STR : ACC_STR;

BEGIN
     TEST ("CE2120A", "FOR DIRECT_IO, CHECK THAT IF THE " &
                      "IMPLEMENTATION ALLOWS ALTERNATE FORMS OF THE " &
                      "NAME, THEN NAME RETURNS A FULL SPECIFICATION " &
                      "OF THE NAME");

     BEGIN
          BEGIN
               CREATE (FILE, OUT_FILE, LEGAL_FILE_NAME);
          EXCEPTION
               WHEN USE_ERROR =>
                    NOT_APPLICABLE ("USE_ERROR RAISED ON CREATE " &
                                    "WITH OUT_FILE MODE");
                    RAISE INCOMPLETE;
               WHEN NAME_ERROR =>
                    NOT_APPLICABLE ("NAME_ERROR RAISED ON CREATE " &
                                    "WITH OUT_FILE MODE");
                    RAISE INCOMPLETE;
               WHEN OTHERS =>
                    FAILED ("UNEXPECTED EXCEPTION RAISED ON CREATE");
                    RAISE INCOMPLETE;
          END;

          WRITE (FILE, 3);

          NAME_STR := NEW STRING'(NAME(FILE));

          IF NAME_STR.ALL /=
"$NAME_SPECIFICATION1"
               THEN FAILED ("FULL NAME SPECIFICATION NOT RETURNED " &
                            "FROM FUNCTION NAME");
          END IF;

          BEGIN
               DELETE (FILE);
          EXCEPTION
               WHEN USE_ERROR =>
                    NULL;
          END;
     EXCEPTION
          WHEN INCOMPLETE =>
               NULL;
     END;

     RESULT;
END CE2120A;
