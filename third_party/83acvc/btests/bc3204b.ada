-- BC3204B.ADA

-- CHECK THAT AN INSTANTIATION IS ILLEGAL WHEN A LIMITED/NON-LIMITED
-- FORMAL PRIVATE TYPE IS USED AS THE PARENT TYPE IN A DERIVED TYPE
-- DEFINITION APPEARING IN THE FULL DECLARATION OF A PRIVATE TYPE,
-- AND THE ACTUAL TYPE IS AN UNCONSTRAINED ARRAY TYPE OR AN
-- UNCONSTRAINED TYPE WITH DISCRIMINANTS WITHOUT DEFAULTS.

-- TEST WHERE THE INSTANTIATIONS APPEAR BEFORE THE GENERIC BODY.

-- SPS 7/12/82
-- JBG 4/29/85

--          **************************************************
-- AS A RESULT OF ADA COMMENTARY AI-00037, INSTANTIATIONS ARE ALWAYS
-- LEGAL IF THE FORMAL PARAMETER IS A PRIVATE TYPE WITHOUT DISCRIMINANTS
-- AND THE ACTUAL PARAMETER IS A TYPE WITH DEFAULT DISCRIMINANTS.
--          **************************************************

PROCEDURE BC3204B IS

     TYPE UARR IS ARRAY(INTEGER RANGE <>) OF INTEGER;
     TYPE CARR IS ARRAY(INTEGER RANGE 1..10) OF INTEGER;
     TYPE REC(D : INTEGER) IS RECORD NULL; END RECORD;
     TYPE DREC(D : INTEGER := 3) IS RECORD NULL; END RECORD;
     SUBTYPE CREC IS REC(D => 3);

     GENERIC
          TYPE PV IS PRIVATE;
          TYPE LP IS LIMITED PRIVATE;
          TYPE P IS PRIVATE;
          TYPE L IS LIMITED PRIVATE;
     PACKAGE PK IS END PK;

     PROCEDURE PROC IS
          PACKAGE N1 IS NEW PK(REC, CREC, CREC, CREC);  -- ERROR: REC 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N2 IS NEW PK(DREC, CREC, CREC, CREC); -- OK: AI-00037.
          PACKAGE N3 IS NEW PK(CREC, REC, CREC, CREC);  -- ERROR: REC 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N4 IS NEW PK(CREC, DREC, CREC, CREC); -- OK: AI-00037
          PACKAGE N5 IS NEW PK(CREC, CREC, REC, CREC);  -- ERROR: REC 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N6 IS NEW PK(CREC, CREC, DREC, CREC); -- OK: AI-00037
          PACKAGE N7 IS NEW PK(CREC, CREC, CREC, REC);  -- ERROR: REC 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N8 IS NEW PK(CREC, CREC, CREC, DREC); -- OK: AI-00037
          PACKAGE N9 IS NEW PK(UARR, CARR, CARR, CARR); -- ERROR: UARR 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N10 IS NEW PK(CARR, UARR, CARR, CARR);-- ERROR: UARR 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N11 IS NEW PK(CARR, CARR, UARR, CARR);-- ERROR: UARR 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N12 IS NEW PK(CARR, CARR, CARR, UARR);-- ERROR: UARR 
                                                   -- IS UNCONSTRAINED.
          PACKAGE N13 IS NEW PK(CREC, CREC, CREC, CREC);-- OK.
          PACKAGE N14 IS NEW PK(CARR, CARR, CARR, CARR);-- OK.
     BEGIN
          NULL;
     END PROC;

     PACKAGE BODY PK IS

          SUBTYPE SP IS P;
          SUBTYPE SL IS L;

          TYPE DP IS NEW SP;
          TYPE DL IS NEW SL;
          SUBTYPE SDL IS DL;

          PACKAGE PRIV IS
               TYPE PP IS PRIVATE;
               TYPE PL IS LIMITED PRIVATE;
               TYPE PPV IS PRIVATE;
               TYPE PLP IS LIMITED PRIVATE;

          PRIVATE
               TYPE PP IS NEW DP;       -- POTENTIALLY ILLEGAL.
               TYPE PL IS NEW SDL;      -- POTENTIALLY ILLEGAL.
               TYPE PPV IS NEW PV;      -- POTENTIALLY ILLEGAL.
               TYPE PLP IS NEW LP;      -- POTENTIALLY ILLEGAL.
          END PRIV;

     BEGIN
          NULL;
     END PK;
BEGIN
     NULL;
END BC3204B;
